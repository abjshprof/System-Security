CC=gcc
GRP_ID=3
CFLAGS=-g -Wall -m32 -DGRP=$(GRP_ID) -DLEN1=1021 -DLEN2=256 -DLEN3=1000 -DRANDOM=0
#CFLAGS=-g -Wall -DLEN1=1021 -DLEN2=256 -DLEN3=1000 -DRANDOM=random\(\)

all: vuln heap_overflow stack_smashing_1c stack_smashing_1a stack_smashing_1b format_string_2 driver_authd_expl_1d

vuln: vuln.o my_malloc.o
	$(CC) $(CFLAGS) -o vuln vuln.o my_malloc.o
	execstack -s vuln

vuln.o: padding.h vuln.c my_malloc.h
	$(CC) $(CFLAGS) -c vuln.c

vuln.s: vuln.c my_malloc.h
	$(CC) $(CFLAGS) -DASM_ONLY  -c vuln.c > vuln.s
	rm vuln.o

my_malloc.o: my_malloc.h my_malloc.c
	$(CC) $(CFLAGS)  -c my_malloc.c

heap_overflow: heap_overflow.c
	$(CC) $(CFLAGS) -o heap_overflow heap_overflow.c

stack_smashing_1c:
	$(CC) $(CFLAGS) -o stack_smashing_1c stack_smashing_1c.c

stack_smashing_1a:
	$(CC) $(CFLAGS) -o stack_smashing_1a stack_smashing_1a.c

stack_smashing_1b:
	$(CC) $(CFLAGS) -o stack_smashing_1b stack_smashing_1b.c

format_string_2:
	$(CC) $(CFLAGS) -o format_string_2 format_string_2.c

driver_authd_expl_1d:
	$(CC) $(CFLAGS) -o driver_authd_expl_1d driver_authd_expl_1d.c

padding.h:
	./mkpad $(GRP_ID)

clean:
	rm -f vuln vuln.o my_malloc.o vuln.s padding.h heap_overflow stack_smashing_1b stack_smashing_1c stack_smashing_1a driver_authd_expl_1d format_string_2
